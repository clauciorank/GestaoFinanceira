#!/usr/bin/env python3
"""
Script para gerar certificados SSL auto-assinados para desenvolvimento
"""
import os
import subprocess
from pathlib import Path

def generate_self_signed_cert():
    """Gera certificado SSL auto-assinado para desenvolvimento"""
    
    # Cria o diret√≥rio de certificados se n√£o existir
    certs_dir = Path("certs")
    certs_dir.mkdir(exist_ok=True)
    
    cert_file = certs_dir / "cert.pem"
    key_file = certs_dir / "key.pem"
    
    # Verifica se j√° existem certificados
    if cert_file.exists() and key_file.exists():
        print("‚ö†Ô∏è  Certificados j√° existem!")
        resposta = input("Deseja regenerar? (s/N): ")
        if resposta.lower() != 's':
            print("Opera√ß√£o cancelada.")
            return
    
    print("üîê Gerando certificado SSL auto-assinado...")
    print("   (Apenas para desenvolvimento - n√£o use em produ√ß√£o!)")
    print()
    
    # Comando openssl para gerar certificado auto-assinado
    cmd = [
        "openssl", "req", "-x509", "-newkey", "rsa:4096",
        "-nodes", "-out", str(cert_file),
        "-keyout", str(key_file),
        "-days", "365",
        "-subj", "/C=BR/ST=State/L=City/O=GestorFinanceiro/CN=localhost"
    ]
    
    try:
        subprocess.run(cmd, check=True, capture_output=True)
        print("‚úÖ Certificados gerados com sucesso!")
        print(f"   Certificado: {cert_file}")
        print(f"   Chave: {key_file}")
        print()
        print("‚ö†Ô∏è  IMPORTANTE:")
        print("   - Estes s√£o certificados auto-assinados (apenas para desenvolvimento)")
        print("   - Seu navegador mostrar√° um aviso de seguran√ßa (isso √© normal)")
        print("   - Para produ√ß√£o, use certificados de uma CA confi√°vel (Let's Encrypt, etc.)")
        print()
        print("üí° Para usar HTTPS, configure no .env:")
        print("   USE_HTTPS=true")
        
    except subprocess.CalledProcessError as e:
        print(f"‚ùå Erro ao gerar certificados: {e}")
        print()
        print("üí° Certifique-se de que o OpenSSL est√° instalado:")
        print("   Ubuntu/Debian: sudo apt-get install openssl")
        print("   macOS: brew install openssl")
        print("   Windows: Baixe de https://slproweb.com/products/Win32OpenSSL.html")
    except FileNotFoundError:
        print("‚ùå OpenSSL n√£o encontrado!")
        print()
        print("üí° Instale o OpenSSL:")
        print("   Ubuntu/Debian: sudo apt-get install openssl")
        print("   macOS: brew install openssl")
        print("   Windows: Baixe de https://slproweb.com/products/Win32OpenSSL.html")

if __name__ == "__main__":
    generate_self_signed_cert()

